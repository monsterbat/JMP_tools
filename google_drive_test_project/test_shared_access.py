#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
æ¸¬è©¦å…±äº«å­˜å–æ¨¡å¼

æ¨¡æ“¬ä¼æ¥­ç’°å¢ƒï¼š
- Aäººå“¡åˆ†äº«æª”æ¡ˆçµ¦Bäººå“¡
- Bäººå“¡ç”¨è‡ªå·±çš„å¸³è™Ÿå­˜å–Aåˆ†äº«çš„æª”æ¡ˆ
"""

import os
from google_drive_utils import download_enterprise_google_drive_file

def test_shared_access():
    """æ¸¬è©¦å…±äº«å­˜å–åŠŸèƒ½"""
    print("=== ä¼æ¥­ç´šå…±äº«å­˜å–æ¸¬è©¦ ===")
    print()
    print("ğŸ¢ æ¨¡æ“¬æƒ…å¢ƒï¼š")
    print("â€¢ Aäººå“¡ï¼ˆè³‡æ–™æ“æœ‰è€…ï¼‰ä¸Šå‚³æª”æ¡ˆåˆ°è‡ªå·±çš„ Google Drive")
    print("â€¢ Aäººå“¡å°‡æª”æ¡ˆåˆ†äº«çµ¦Bäººå“¡ï¼ˆæª¢è¦–æ¬Šé™ï¼‰")
    print("â€¢ Bäººå“¡ï¼ˆæ‚¨ï¼‰ç”¨è‡ªå·±çš„å¸³è™Ÿç™»å…¥ç¨‹å¼")
    print("â€¢ Bäººå“¡å­˜å–Aåˆ†äº«çš„æª”æ¡ˆ")
    print()
    
    # æª¢æŸ¥æ†‘è­‰æª”æ¡ˆ
    if not os.path.exists('credentials.json'):
        print("âŒ æ‰¾ä¸åˆ° credentials.json æª”æ¡ˆ")
        return False
    
    print("âœ… æ‰¾åˆ° credentials.json æª”æ¡ˆ")
    print()
    
    print("ğŸ“‹ æ¸¬è©¦æ­¥é©Ÿï¼š")
    print("1. è«‹Aäººå“¡å°‡æª”æ¡ˆåˆ†äº«çµ¦æ‚¨çš„ Google å¸³è™Ÿ")
    print("2. ç¢ºèªæ‚¨å·²æ”¶åˆ°åˆ†äº«é€šçŸ¥")
    print("3. è¼¸å…¥Aäººå“¡åˆ†äº«çµ¦æ‚¨çš„æª”æ¡ˆé€£çµ")
    print()
    
    # è«‹ä½¿ç”¨è€…è¼¸å…¥åˆ†äº«çš„æª”æ¡ˆé€£çµ
    shared_url = input("è«‹è¼¸å…¥Aäººå“¡åˆ†äº«çµ¦æ‚¨çš„æª”æ¡ˆé€£çµ: ").strip()
    
    if not shared_url:
        print("âŒ æœªè¼¸å…¥é€£çµ")
        return False
    
    print()
    print("ğŸ” é–‹å§‹æ¸¬è©¦å…±äº«å­˜å–...")
    print("ç³»çµ±æœƒä½¿ç”¨æ‚¨çš„ Google å¸³è™Ÿé€²è¡Œèªè­‰")
    print("ç„¶å¾Œå­˜å–Aäººå“¡åˆ†äº«çµ¦æ‚¨çš„æª”æ¡ˆ")
    print()
    
    try:
        # æ¸¬è©¦ä¸‹è¼‰åˆ†äº«çš„æª”æ¡ˆ
        downloaded_file = download_enterprise_google_drive_file(shared_url)
        
        if downloaded_file and os.path.exists(downloaded_file):
            print(f"âœ… å…±äº«å­˜å–æ¸¬è©¦æˆåŠŸï¼")
            print(f"ğŸ“ æª”æ¡ˆå·²ä¸‹è¼‰åˆ°: {downloaded_file}")
            print()
            print("ğŸ‰ ä¼æ¥­ç´šå…±äº«å­˜å–æ¨¡å¼æ­£å¸¸é‹ä½œï¼")
            print()
            print("ğŸ“Š é€™è­‰æ˜äº†ï¼š")
            print("â€¢ âœ… Bäººå“¡å¯ä»¥ç”¨è‡ªå·±çš„å¸³è™Ÿç™»å…¥")
            print("â€¢ âœ… Bäººå“¡å¯ä»¥å­˜å–Aäººå“¡åˆ†äº«çš„æª”æ¡ˆ")
            print("â€¢ âœ… æ¬Šé™æ§åˆ¶æ­£å¸¸é‹ä½œ")
            print("â€¢ âœ… ç¬¦åˆä¼æ¥­å®‰å…¨è¦æ±‚")
            return True
        else:
            print("âŒ ä¸‹è¼‰å¤±æ•—ï¼šæª”æ¡ˆä¸å­˜åœ¨")
            return False
            
    except Exception as e:
        error_msg = str(e)
        print(f"âŒ å…±äº«å­˜å–æ¸¬è©¦å¤±æ•—: {error_msg}")
        print()
        
        if "æ¬Šé™éŒ¯èª¤" in error_msg:
            print("ğŸ” å¯èƒ½çš„åŸå› ï¼š")
            print("1. Aäººå“¡å°šæœªå°‡æª”æ¡ˆåˆ†äº«çµ¦æ‚¨")
            print("2. åˆ†äº«æ¬Šé™è¨­å®šä¸æ­£ç¢º")
            print("3. æ‚¨ä½¿ç”¨äº†éŒ¯èª¤çš„ Google å¸³è™Ÿç™»å…¥")
            print()
            print("ğŸ’¡ è§£æ±ºå»ºè­°ï¼š")
            print("1. è«‹Aäººå“¡ç¢ºèªå·²å°‡æª”æ¡ˆåˆ†äº«çµ¦æ‚¨çš„ email")
            print("2. ç¢ºèªåˆ†äº«æ¬Šé™è‡³å°‘æ˜¯ã€Œæª¢è¦–è€…ã€")
            print("3. åœ¨ OAuth èªè­‰æ™‚é¸æ“‡æ­£ç¢ºçš„ Google å¸³è™Ÿ")
        
        return False

def simulate_enterprise_workflow():
    """æ¨¡æ“¬ä¼æ¥­å·¥ä½œæµç¨‹"""
    print()
    print("=" * 50)
    print("ğŸ¢ ä¼æ¥­ç´š Google Drive å…±äº«å·¥ä½œæµç¨‹")
    print("=" * 50)
    print()
    
    print("ğŸ‘¤ Aäººå“¡ï¼ˆè³‡æ–™æ“æœ‰è€…ï¼‰çš„æ“ä½œï¼š")
    print("1. ä¸Šå‚³æª”æ¡ˆåˆ°è‡ªå·±çš„ Google Drive")
    print("2. å³éµé»æ“Šæª”æ¡ˆ â†’ å…±ç”¨")
    print("3. è¼¸å…¥Bäººå“¡çš„ Google email")
    print("4. è¨­å®šæ¬Šé™ç‚ºã€Œæª¢è¦–è€…ã€æˆ–ã€Œç·¨è¼¯è€…ã€")
    print("5. é»æ“Šã€Œå‚³é€ã€")
    print()
    
    print("ğŸ‘¤ Bäººå“¡ï¼ˆç¨‹å¼ä½¿ç”¨è€…ï¼‰çš„æ“ä½œï¼š")
    print("1. æ”¶åˆ° Google Drive åˆ†äº«é€šçŸ¥")
    print("2. é»æ“Šé€šçŸ¥ä¸­çš„æª”æ¡ˆé€£çµ")
    print("3. è¤‡è£½ç€è¦½å™¨ä¸­çš„æª”æ¡ˆ URL")
    print("4. åœ¨ç¨‹å¼ä¸­ä½¿ç”¨ä¼æ¥­ç‰ˆåŠŸèƒ½")
    print("5. ç”¨è‡ªå·±çš„ Google å¸³è™Ÿé€²è¡Œ OAuth èªè­‰")
    print("6. è¼¸å…¥æª”æ¡ˆé€£çµä¸¦ä¸‹è¼‰")
    print()
    
    print("ğŸ¯ é€™å€‹æµç¨‹çš„å„ªå‹¢ï¼š")
    print("â€¢ ğŸ” å®Œå…¨ç¬¦åˆä¼æ¥­å®‰å…¨è¦æ±‚")
    print("â€¢ ğŸ‘¥ æ”¯æ´å¤šäººå”ä½œ")
    print("â€¢ ğŸ›¡ï¸ æ¬Šé™å¯ä»¥éš¨æ™‚æ’¤éŠ·")
    print("â€¢ ğŸ“Š æœ‰å®Œæ•´çš„å­˜å–è¨˜éŒ„")
    print("â€¢ ğŸ”„ å¯ä»¥è¨­å®šä¸åŒçš„æ¬Šé™ç­‰ç´š")

if __name__ == "__main__":
    # é¡¯ç¤ºä¼æ¥­å·¥ä½œæµç¨‹èªªæ˜
    simulate_enterprise_workflow()
    
    print()
    input("æŒ‰ Enter éµé–‹å§‹æ¸¬è©¦å…±äº«å­˜å–åŠŸèƒ½...")
    
    # åŸ·è¡Œå…±äº«å­˜å–æ¸¬è©¦
    success = test_shared_access()
    
    print()
    if success:
        print("ğŸ¯ æ¸¬è©¦çµè«–ï¼šä¼æ¥­ç´šå…±äº«å­˜å–æ¨¡å¼å®Œå…¨å¯è¡Œï¼")
        print()
        print("ğŸš€ æ¥ä¸‹ä¾†æ‚¨å¯ä»¥ï¼š")
        print("1. è«‹åŒäº‹æˆ–åˆä½œå¤¥ä¼´åˆ†äº«æª”æ¡ˆçµ¦æ‚¨")
        print("2. ä½¿ç”¨ä¼æ¥­ç‰ˆåŠŸèƒ½å­˜å–åˆ†äº«çš„æª”æ¡ˆ")
        print("3. å»ºç«‹æ¨™æº–åŒ–çš„æª”æ¡ˆåˆ†äº«æµç¨‹")
    else:
        print("ğŸ”§ è«‹æŒ‰ç…§ä¸Šè¿°å»ºè­°æª¢æŸ¥è¨­å®š")
        print()
        print("ğŸ’¡ è¨˜ä½ï¼šé€™å€‹æ¨¡å¼éœ€è¦Aäººå“¡ä¸»å‹•åˆ†äº«æª”æ¡ˆçµ¦æ‚¨") 